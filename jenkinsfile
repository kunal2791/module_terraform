pipeline {
	agent any
  environment {
    GIT_URL="https://github.com/kunal2791/module_terraform.git/"
    //SPECIFIER="master"
    }
  parameters {
    string(defaultValue: "develop", description: 'Branch Specifier', name: 'SPECIFIER')
    }
	stages {
    stage('Checkout') {
    steps {
        git branch: "${SPECIFIER}", url: "${GIT_URL}"
    }
    }
		stage ('initilaze modules') {
      steps {
			sh 'terraform init'
    }
		}
		stage ('terraform checking all modules') {
      steps {
			sh 'terraform get'
    }
		}
		stage ('terraform planning infra') {
      steps {
			sh 'terraform plan'
    }
		}
		//stage ('terraform applying changes to infra') {
      //steps {
			//sh 'terraform apply -input=false -auto-approve'
    //}
		//}
	}
	if (buildStatus == 'STARTED') {
	    color = 'YELLOW'
	    colorCode = '#FFFF00'
	} else if (buildStatus == 'SUCCESS') {
	    color = 'GREEN'
	    colorCode = '#00FF00'
	} else {
	    color = 'RED'
	    colorCode = '#FF0000'
	}

	// Send notifications
	if (buildStatus == 'FAILURE') {
	    emailext attachLog: true, body: summary, compressLog: true, recipientProviders: [brokenTestsSuspects(), brokenBuildSuspects(), culprits()], replyTo: 'noreply@yourdomain.com', subject: subject, to: 'kunal2791@gmail.com'
	}
}
